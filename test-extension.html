<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰©å±•æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }
        .status {
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            font-weight: 600;
        }
        .success { background: #4CAF50; }
        .error { background: #f44336; }
        .info { background: #2196F3; }
        .warning { background: #ff9800; }
        .log {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        button {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 5px;
            transition: transform 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª NWS Tools æ‰©å±•æµ‹è¯•é¡µé¢</h1>
        
        <div class="status info" id="testStatus">
            ç­‰å¾…æµ‹è¯•å¼€å§‹...
        </div>
        
        <div style="margin: 20px 0;">
            <button onclick="testModuleSystem()">æµ‹è¯•æ¨¡å—ç³»ç»Ÿ</button>
            <button onclick="testErrorHandler()">æµ‹è¯•é”™è¯¯å¤„ç†å™¨</button>
            <button onclick="testConfigManager()">æµ‹è¯•é…ç½®ç®¡ç†å™¨</button>
            <button onclick="testStyleManager()">æµ‹è¯•æ ·å¼ç®¡ç†å™¨</button>
            <button onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
        </div>
        
        <div class="log" id="logOutput"></div>
    </div>

    <script>
        function updateStatus(message, type = 'info') {
            const statusEl = document.getElementById('testStatus');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }

        function log(message, type = 'info') {
            const logEl = document.getElementById('logOutput');
            const timestamp = new Date().toLocaleTimeString();
            const typeEmoji = {
                'info': 'â„¹ï¸',
                'success': 'âœ…',
                'error': 'âŒ',
                'warning': 'âš ï¸'
            };
            logEl.textContent += `[${timestamp}] ${typeEmoji[type]} ${message}\n`;
            logEl.scrollTop = logEl.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('logOutput').textContent = '';
        }

        function testModuleSystem() {
            updateStatus('æµ‹è¯•æ¨¡å—ç³»ç»Ÿ...', 'info');
            log('å¼€å§‹æµ‹è¯•æ¨¡å—ç³»ç»Ÿ', 'info');

            try {
                // æµ‹è¯•æ¨¡å—ç®¡ç†å™¨
                if (window.NWSModules) {
                    log('âœ… NWSModuleså…¨å±€å¯¹è±¡å­˜åœ¨', 'success');
                    
                    // æµ‹è¯•æ ¸å¿ƒæ¨¡å—
                    const coreModules = ['ModuleManager', 'ChromeSettingsModule'];
                    coreModules.forEach(module => {
                        if (window.NWSModules[module]) {
                            log(`âœ… ${module} æ¨¡å—åŠ è½½æˆåŠŸ`, 'success');
                        } else {
                            log(`âŒ ${module} æ¨¡å—ç¼ºå¤±`, 'error');
                        }
                    });

                    // æµ‹è¯•åŠŸèƒ½æ¨¡å—
                    const featureModules = ['NotificationModule', 'ImageDownloaderModule', 'ElementHighlighterModule'];
                    featureModules.forEach(module => {
                        if (window.NWSModules[module]) {
                            log(`âœ… ${module} åŠŸèƒ½æ¨¡å—åŠ è½½æˆåŠŸ`, 'success');
                        } else {
                            log(`âŒ ${module} åŠŸèƒ½æ¨¡å—ç¼ºå¤±`, 'error');
                        }
                    });

                    updateStatus('æ¨¡å—ç³»ç»Ÿæµ‹è¯•å®Œæˆ', 'success');
                } else {
                    log('âŒ NWSModuleså…¨å±€å¯¹è±¡ä¸å­˜åœ¨', 'error');
                    updateStatus('æ¨¡å—ç³»ç»Ÿæµ‹è¯•å¤±è´¥', 'error');
                }
            } catch (error) {
                log(`âŒ æ¨¡å—ç³»ç»Ÿæµ‹è¯•å¼‚å¸¸: ${error.message}`, 'error');
                updateStatus('æ¨¡å—ç³»ç»Ÿæµ‹è¯•å¼‚å¸¸', 'error');
            }
        }

        function testErrorHandler() {
            updateStatus('æµ‹è¯•é”™è¯¯å¤„ç†å™¨...', 'info');
            log('å¼€å§‹æµ‹è¯•é”™è¯¯å¤„ç†å™¨', 'info');

            try {
                // æµ‹è¯•initErrorHandlerå‡½æ•°
                if (typeof window.initErrorHandler === 'function') {
                    log('âœ… initErrorHandlerå‡½æ•°å­˜åœ¨', 'success');
                    
                    // æµ‹è¯•é”™è¯¯å¤„ç†å™¨
                    window.initErrorHandler();
                    log('âœ… é”™è¯¯å¤„ç†å™¨åˆå§‹åŒ–æˆåŠŸ', 'success');
                    
                    // æµ‹è¯•ErrorHandleræ¨¡å—
                    if (window.NWSModules && window.NWSModules.ErrorHandler) {
                        log('âœ… ErrorHandleræ¨¡å—å­˜åœ¨', 'success');
                        
                        const errorHandler = window.NWSModules.ErrorHandler;
                        const methods = ['safeExecute', 'safeExecuteAsync', 'createErrorBoundary'];
                        methods.forEach(method => {
                            if (typeof errorHandler[method] === 'function') {
                                log(`âœ… ${method} æ–¹æ³•å¯ç”¨`, 'success');
                            } else {
                                log(`âŒ ${method} æ–¹æ³•ä¸å¯ç”¨`, 'error');
                            }
                        });
                    } else {
                        log('âš ï¸ ErrorHandleræ¨¡å—ä¸å­˜åœ¨ï¼ˆå¯èƒ½æ˜¯æ­£å¸¸çš„ï¼‰', 'warning');
                    }
                    
                    updateStatus('é”™è¯¯å¤„ç†å™¨æµ‹è¯•å®Œæˆ', 'success');
                } else {
                    log('âŒ initErrorHandlerå‡½æ•°ä¸å­˜åœ¨', 'error');
                    updateStatus('é”™è¯¯å¤„ç†å™¨æµ‹è¯•å¤±è´¥', 'error');
                }
            } catch (error) {
                log(`âŒ é”™è¯¯å¤„ç†å™¨æµ‹è¯•å¼‚å¸¸: ${error.message}`, 'error');
                updateStatus('é”™è¯¯å¤„ç†å™¨æµ‹è¯•å¼‚å¸¸', 'error');
            }
        }

        function testConfigManager() {
            updateStatus('æµ‹è¯•é…ç½®ç®¡ç†å™¨...', 'info');
            log('å¼€å§‹æµ‹è¯•é…ç½®ç®¡ç†å™¨', 'info');

            try {
                // æµ‹è¯•ConfigManagerç±»
                if (typeof window.ConfigManager === 'function') {
                    log('âœ… ConfigManagerç±»å­˜åœ¨', 'success');
                    
                    // å°è¯•åˆ›å»ºå®ä¾‹ï¼ˆéœ€è¦Chrome APIï¼‰
                    if (window.NWSModules && window.NWSModules.ChromeSettingsModule) {
                        const storage = window.NWSModules.ChromeSettingsModule;
                        const configManager = new window.ConfigManager(storage, 'test', { enabled: true });
                        log('âœ… ConfigManagerå®ä¾‹åˆ›å»ºæˆåŠŸ', 'success');
                    } else {
                        log('âš ï¸ ChromeSettingsModuleä¸å¯ç”¨ï¼Œè·³è¿‡å®ä¾‹æµ‹è¯•', 'warning');
                    }
                } else {
                    log('âŒ ConfigManagerç±»ä¸å­˜åœ¨', 'error');
                    updateStatus('é…ç½®ç®¡ç†å™¨æµ‹è¯•å¤±è´¥', 'error');
                }
            } catch (error) {
                log(`âŒ é…ç½®ç®¡ç†å™¨æµ‹è¯•å¼‚å¸¸: ${error.message}`, 'error');
                updateStatus('é…ç½®ç®¡ç†å™¨æµ‹è¯•å¼‚å¸¸', 'error');
            }
        }

        function testStyleManager() {
            updateStatus('æµ‹è¯•æ ·å¼ç®¡ç†å™¨...', 'info');
            log('å¼€å§‹æµ‹è¯•æ ·å¼ç®¡ç†å™¨', 'info');

            try {
                // æµ‹è¯•StyleManagerç±»
                if (typeof window.StyleManager === 'function') {
                    log('âœ… StyleManagerç±»å­˜åœ¨', 'success');
                    
                    // æµ‹è¯•å•ä¾‹å®ä¾‹
                    if (window.styleManager && typeof window.styleManager.inject === 'function') {
                        log('âœ… StyleManagerå•ä¾‹å®ä¾‹å¯ç”¨', 'success');
                        
                        // æµ‹è¯•æ–¹æ³•
                        const methods = ['inject', 'remove', 'getAll', 'clear'];
                        methods.forEach(method => {
                            if (typeof window.styleManager[method] === 'function') {
                                log(`âœ… ${method} æ–¹æ³•å¯ç”¨`, 'success');
                            } else {
                                log(`âŒ ${method} æ–¹æ³•ä¸å¯ç”¨`, 'error');
                            }
                        });
                    } else {
                        log('âŒ StyleManagerå•ä¾‹å®ä¾‹ä¸å¯ç”¨', 'error');
                    }
                } else {
                    log('âŒ StyleManagerç±»ä¸å­˜åœ¨', 'error');
                    updateStatus('æ ·å¼ç®¡ç†å™¨æµ‹è¯•å¤±è´¥', 'error');
                }
            } catch (error) {
                log(`âŒ æ ·å¼ç®¡ç†å™¨æµ‹è¯•å¼‚å¸¸: ${error.message}`, 'error');
                updateStatus('æ ·å¼ç®¡ç†å™¨æµ‹è¯•å¼‚å¸¸', 'error');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                log('ğŸš€ å¼€å§‹è‡ªåŠ¨æµ‹è¯•', 'info');
                testModuleSystem();
                setTimeout(() => testErrorHandler(), 1000);
                setTimeout(() => testConfigManager(), 2000);
                setTimeout(() => testStyleManager(), 3000);
            }, 1000);
        });

        // ç›‘å¬NWS Toolsåˆå§‹åŒ–å®Œæˆäº‹ä»¶
        document.addEventListener('nws:initialized', () => {
            updateStatus('âœ… NWS Tools åˆå§‹åŒ–å®Œæˆï¼', 'success');
            log('ğŸ‰ NWS Tools å®Œå…¨åˆå§‹åŒ–æˆåŠŸï¼', 'success');
        });
    </script>
</body>
</html>